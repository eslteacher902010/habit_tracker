{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block content %}

<h1>Habit Tracker</h1>

<!-- 🔔 Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flashes">
      {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- 📝 Add New Habit Form -->
<form method="POST" class="mb-4">
  {{ form.hidden_tag() }}
  <div class="mb-2">
    {{ form.name.label }} {{ form.name(size=30, class_="form-control d-inline w-auto") }}
  </div>
  {{ form.submit(class_="btn btn-success") }}
</form>


<!-- ✅ Habit List with Checkboxes -->
<h2>Today's Habits</h2>
<div class="border border-primary">
<ul class="list-group mb-4">
  {% for habit in habits_today %}
    <li class="list-group-item">
      {{ macros.habit_item(habit) }}
      <div class="d-flex justify-content-end mt-2">
        <a class="btn btn-outline-primary btn-sm" href="{{ url_for('edit_habit', habit_id=habit.id) }}">
          ✏️ Edit Habit
        </a>
      </div>
    </li>
  {% endfor %}
</ul>
</div>

<h2>Completed</h2>
<div class="border border-success">
<ul class="list-group mb-4">
  {% for habit in completed_habits %}
    <li class="list-group-item">
      {{ macros.habit_item(habit) }}
      <div class="d-flex justify-content-end mt-2">
        <a class="btn btn-outline-primary btn-sm me-2" href="{{ url_for('edit_habit', habit_id=habit.id) }}">
          ✏️ Edit Habit
        </a>
        <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('single_graph', habit_id=habit.id) }}">
          📊 Track This Habit
        </a>
      </div>
    </li>
  {% endfor %}
</ul>
</div>


<!-- ❌ Delete Last Habit -->
{% if habits %}
  <section class="mt-4">
    <form action="{{ url_for('delete_habit', habit_id=habits[-1].id) }}" method="POST">
      <button class="btn btn-danger" type="submit">Delete Last Habit</button>
    </form>
  </section>
{% endif %}

<script>
  setTimeout(function () {
    const flashes = document.querySelectorAll('.flashes li');
    flashes.forEach(function (flash) {
      flash.classList.add('fade-out');
      setTimeout(() => flash.style.display = 'none', 500);
    });
  }, 5000);
</script>



{% endblock %}
